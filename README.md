# mmaconv

mmaconv provides a library and a set of command to help the extraction of raw MMA data and their conversion into calibrated temperatures and acceleration.

### Commands

#### mmaconv

mmaconv command convert the raw binary data found into a directory/file into their calibrated values (temperatures and acceleration).

the output is a csv file with the following columns:

* time
* upi
* sequence (milbus sequence counter)
* vmu-sequence
* Tx, Ty, Tz (degree celsius)
* Ax, Ay, Az (micro gravity)

options:

* [-a]: write all fields from a measurement in the output
* [-c]: use the conversion table given in a configuration file (toml format)
* [-f]: write all values from one block on the same line instead of multiple line
* [-i]: format time with a ISO format
* [-j]: adjust the time for each row in the output
* [-o]: read files in a given directory by ordering them by their acquisition time
* [-q]: does not print anything to stdout
* [-r]: walk recursively throught all files for the given directory
* [-t]: use the given duration as time between two row in the output
* [-w]: write output to given file. It creates the file if it does not exist
* [-z]: compress output

```bash
$ mmaconv -j -o -r -w mma.csv.gz -z tmp/mma

$ mmaconv -j -i -r tmp/mma
```

#### mmaextract

mmaextract extracts the data from a raw binary file and output the results to stdout.

```bash
mmaextract tmp/mma/0051_SCIENCE_3_000000_20210529_101010.dat
9,4086,10073,10286,9930,-437,-243,-52,-369,-299,-134,-315,-299,-109,-336,-283,-20,-355,-293,-39,-373,-276,-19,-422,-286,-28,-457,-219,-68,-450,-135,-133
9,4095,10073,10286,9932,-436,-131,-165,-464,-156,-161,-437,-294,-96,-376,-351,-73,-326,-334,-36,-355,-284,-25,-361,-250,-1,-393,-220,-33,-412,-175,-60
```

#### mmacheck

mmacheck output a summary where it detects an inconsistency between two lines in a file given in argument. The given file i ssupposed to be one generated by the mmaconv command.

```bash
$ mmacheck mma-128.csv
217225: 2018-09-18 11:53:49.954940 - 2018-09-18 11:53:49.952344 => diff:   -2.596ms (prev:  56167, curr:  56176, delta:      9)
218728: 2018-09-18 11:53:50.953676 - 2018-09-18 11:53:50.952872 => diff:     -804µs (prev:  57670, curr:  57679, delta:      9)
220222: 2018-09-18 11:53:51.948205 - 2018-09-18 11:53:51.952581 => diff:    4.376ms (prev:  59164, curr:  59173, delta:      9)
221725: 2018-09-18 11:53:52.953913 - 2018-09-18 11:53:52.951989 => diff:   -1.924ms (prev:  60667, curr:  60676, delta:      9)
223228: 2018-09-18 11:53:53.953322 - 2018-09-18 11:53:53.951245 => diff:   -2.077ms (prev:  62170, curr:  62179, delta:      9)
224722: 2018-09-18 11:53:54.946577 - 2018-09-18 11:53:54.951267 => diff:     4.69ms (prev:  63664, curr:  63673, delta:      9)
226225: 2018-09-18 11:53:55.952599 - 2018-09-18 11:53:55.952226 => diff:     -373µs (prev:  65167, curr:  65176, delta:      9)
```

#### mmastats

mmastats command walks throught the list of files and directories and output the frequency of number of blocks per files/directories

options:

* [-b]:
* [-s]:
* [-v]:

```bash
$ mmastats -b {playback,realtime}/51/*/*
doy 112:  396:     24 (vmu-seq:  16404)
         1485:    100 (vmu-seq:  16217)
         1494:   7639 (vmu-seq:  16083)
         1503:  14113 (vmu-seq:  16081)
         1512:    380 (vmu-seq:  16099)
         1521:      1 (vmu-seq:  30468)
         1530:      1 (vmu-seq:  26615)
         1584:      1 (vmu-seq:  26612)
         1764:     23 (vmu-seq:  16407)
         1773:      1 (vmu-seq:  34774)
         1980:     50 (vmu-seq:  16405)

$ mmastats -s {playback,realtime}/51/*/*
summary  396:     24 (vmu-seq:      0)
        1485:    176 (vmu-seq:      0)
        1494:  13334 (vmu-seq:      0)
        1503:  24673 (vmu-seq:      0)
        1512:    684 (vmu-seq:      0)
        1521:      1 (vmu-seq:      0)
        1530:      1 (vmu-seq:      0)
        1584:      1 (vmu-seq:      0)
        1764:     23 (vmu-seq:      0)
        1773:      2 (vmu-seq:      0)
        1980:     52 (vmu-seq:      0)
```
